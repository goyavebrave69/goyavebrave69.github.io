"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[211],{2327:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>u});var s=t(5893),r=t(1151);const o={},i="Cours n\xb03 \ud83c\udf6a",a={id:"SPRING/spring-security/security-three",title:"Cours n\xb03 \ud83c\udf6a",description:"Miam miam, des bons cookies \xe0 consommer \ud83d\ude0b",source:"@site/docs/SPRING/spring-security/security-three.md",sourceDirName:"SPRING/spring-security",slug:"/SPRING/spring-security/security-three",permalink:"/docs/SPRING/spring-security/security-three",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/SPRING/spring-security/security-three.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Cours n\xb02",permalink:"/docs/SPRING/spring-security/security-two"},next:{title:"SPRING - Les tests",permalink:"/docs/category/spring---les-tests"}},c={},u=[{value:"Miam miam, des bons cookies \xe0 consommer \ud83d\ude0b",id:"miam-miam-des-bons-cookies-\xe0-consommer-",level:2},{value:"G\xe9n\xe9ration du cookie",id:"g\xe9n\xe9ration-du-cookie",level:2},{value:"Entity Token",id:"entity-token",level:3},{value:"Modification du service",id:"modification-du-service",level:3},{value:"G\xe9n\xe9ration du Cookie \ud83c\udf6a",id:"g\xe9n\xe9ration-du-cookie-",level:3},{value:"\ud83d\udd2a\ud83e\ude78\ud83d\udea8Un meurtre est en cours et il doit \xeatre emp\xeach\xe9 !",id:"un-meurtre-est-en-cours-et-il-doit-\xeatre-emp\xeach\xe9-",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"cours-n3-",children:"Cours n\xb03 \ud83c\udf6a"}),"\n",(0,s.jsx)(n.h2,{id:"miam-miam-des-bons-cookies-\xe0-consommer-",children:"Miam miam, des bons cookies \xe0 consommer \ud83d\ude0b"}),"\n",(0,s.jsx)(n.p,{children:"Imagine que tu es \xe0 la t\xeate d'une agence spatiale ultra-secr\xe8te \ud83d\ude80. Les tokens, c'est comme les badges d'acc\xe8s \ud83c\udfab qui permettent \xe0 tes astronautes (les utilisateurs) de monter \xe0 bord de ta station spatiale (ton application web). Si tu envoies ces badges d'acc\xe8s dans le corps de la r\xe9ponse, c'est un peu comme si tu diffusais leurs fr\xe9quences \ud83d\udce1 sur les ondes publiques. Les pirates de l'espace \ud83c\udff4\u200d\u2620\ufe0f, toujours \xe0 l'aff\xfbt, pourraient intercepter ces fr\xe9quences et s'infiltrer incognito."}),"\n",(0,s.jsx)(n.p,{children:"Par contre, opter pour envoyer ces badges d'acc\xe8s via des cookies \ud83c\udf6a, c'est comme utiliser un syst\xe8me de t\xe9l\xe9portation s\xe9curis\xe9 \ud83d\udef8 directement vers la poche de l'astronaute. Avec des mesures de s\xe9curit\xe9 comme HttpOnly et Secure flag, c'est comme ajouter un champ de force \ud83d\udee1\ufe0f autour de la t\xe9l\xe9portation, rendant presque impossible pour les pirates de l'espace de mettre la main sur ces pr\xe9cieux badges."}),"\n",(0,s.jsx)(n.p,{children:"En clair, utiliser des cookies pour transmettre les tokens, c'est choisir la voie de la haute technologie pour garder ton \xe9quipage et ta station spatiale en s\xe9curit\xe9. C'est futuriste \ud83c\udf0c, c'est astucieux \ud83e\udde0, et \xe7a assure que ta mission se d\xe9roulera sans accroc. \ud83d\ude80\ud83c\udf20"}),"\n",(0,s.jsx)(n.h2,{id:"g\xe9n\xe9ration-du-cookie",children:"G\xe9n\xe9ration du cookie"}),"\n",(0,s.jsx)(n.p,{children:"Apr\xe8s ce blabla m\xe9taphorique passons au concr\xeat, nous allons donc modifier la fa\xe7on dont nous renvoyons les cookies, et cela en vidant le body qui sera d\xe9sormais vide, pour passer les cookies au travers du header."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'@PostMapping(value = "/login", produces = MediaType.APPLICATION_JSON_VALUE)\npublic ResponseEntity<?> login(@RequestBody User userBody) throws Exception {\n    try {\n        userLoginService.login(userBody);\n        Token token = jwtTokenService.generateToken(userDetailsService.loadUserByUsername(userBody.getUsername()));\n\n        ResponseCookie jwtCookie = ResponseCookie.from("token", token.getToken())\n            .httpOnly(true)   // Marquer le cookie comme HttpOnly pour la s\xe9curit\xe9\n            //.secure(true)     // Marquer le cookie comme s\xe9curis\xe9 (transmis uniquement via HTTPS)\n            .path("/")        // Le cookie est accessible pour l\'ensemble du domaine\n            .maxAge(24 * 60 * 60) // D\xe9finir la dur\xe9e de vie du cookie (exemple : 24 heures)\n            .sameSite("Strict") // Politique SameSite pour le cookie\n            .build();\n\n        return ResponseEntity.ok()\n            .header(HttpHeaders.SET_COOKIE, jwtCookie.toString())\n            .build();\n    } catch (BadCredentialsException e){\n        return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"entity-token",children:"Entity Token"}),"\n",(0,s.jsxs)(n.p,{children:["Nous avons cr\xe9e une nouvelle Entity ",(0,s.jsx)(n.code,{children:"Token"})," qui nous sert \xe0 repr\xe9senter ce dernier dans un objet (POO tmtc), en revanche elle ne sera pas li\xe9e \xe0 la BDD mais nous servira uniquement \xe0 l'int\xe9rieur de notre code."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"public class Token {\n    private String token;\n\n    public String getToken() {\n        return token;\n    }\n\n    public void setToken(String token) {\n        this.token = token;\n    }\n"})}),"\n",(0,s.jsx)(n.h3,{id:"modification-du-service",children:"Modification du service"}),"\n",(0,s.jsxs)(n.p,{children:["Utilisons donc cette Entity afin de renvoyer le token au travers de celle-ci apr\xe8s sa g\xe9n\xe9ration dans la methode ",(0,s.jsx)(n.code,{children:"generateToken"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"public Token generateToken(UserDetails userDetails) {\n    Date now = new Date();\n    Token token = new Token();\n    token.setToken(Jwts.\n        builder()\n            .setSubject(userDetails.getUsername())\n            .setIssuedAt(new Date(System.currentTimeMillis()))\n            .setExpiration(new Date(now.getTime() + JWT_TOKEN_VALIDITY * 1000))\n            .signWith(getSignInKey(), SignatureAlgorithm.HS256)\n            .compact()\n    );\n    return token;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Retournons dans notre controller."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"    return ResponseEntity.ok().header(HttpHeaders.SET_COOKIE, jwtCookie.toString()).build();\n"})}),"\n",(0,s.jsx)(n.p,{children:"Cette ligne de code nous permet de retourner dans le header le TOKEN et de retourner tout cela dans le response.\nAinsi, mon utilisateur recevra automatiquement le cookie dans la response, qui sera r\xe9cup\xe9r\xe9 et stock\xe9 par son navigateur."}),"\n",(0,s.jsx)(n.h3,{id:"g\xe9n\xe9ration-du-cookie-",children:"G\xe9n\xe9ration du Cookie \ud83c\udf6a"}),"\n",(0,s.jsx)(n.p,{children:"Je voudrais maintenant que vous observiez cette partie du code en me disant quel crime a \xe9t\xe9 commis ?"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'    ResponseCookie jwtCookie = ResponseCookie.from("token", token.getToken())\n        .httpOnly(true)   // Marquer le cookie comme HttpOnly pour la s\xe9curit\xe9\n        //.secure(true)     // Marquer le cookie comme s\xe9curis\xe9 (transmis uniquement via HTTPS)\n        .path("/")        // Le cookie est accessible pour l\'ensemble du domaine\n        .maxAge(24 * 60 * 60) // D\xe9finir la dur\xe9e de vie du cookie (exemple : 24 heures)\n        .sameSite("Strict") // Politique SameSite pour le cookie\n        .build();\n'})}),"\n",(0,s.jsx)(n.h2,{id:"un-meurtre-est-en-cours-et-il-doit-\xeatre-emp\xeach\xe9-",children:"\ud83d\udd2a\ud83e\ude78\ud83d\udea8Un meurtre est en cours et il doit \xeatre emp\xeach\xe9 !"}),"\n",(0,s.jsx)(n.p,{children:"Gros comme une maison, l'erreur est flagrante, il ne faut absolument pas mettre ce bout de code dans le controller, mais plut\xf4t dans un service d\xe9di\xe9, alors au boulot jeune Super-H\xe9ros, il faut emp\xeacher ce meurtre de se produire !\nJe n'allais quand m\xeame pas tout faire \xe0 ta place non \ud83d\ude09."})]})}function d(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>i});var s=t(7294);const r={},o=s.createContext(r);function i(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);